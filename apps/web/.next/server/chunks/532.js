"use strict";exports.id=532,exports.ids=[532],exports.modules={651:(a,b,c)=>{c.d(b,{default:()=>g});var d=c(8402),e=c(2521),f=c(107);function g({className:a,style:b,fadeDurationMs:c=800,onLoad:g,...h}){let[i,j]=(0,f.useState)(!1),k=(0,f.useCallback)(a=>{j(!0),g?.(a)},[g]),l=`transition-opacity ease-out ${i?"opacity-100":"opacity-0"}`,m=a?`${a} ${l}`:l,n={...b,transitionDuration:`${c}ms`};return(0,d.jsx)(e.default,{className:m,style:n,onLoad:k,...h})}},7258:(a,b,c)=>{c.d(b,{t:()=>d});function d(a){let b=process.env[a];if(null==b||""===b)throw Error(`Missing required environment variable: ${a}`);return b}},7302:(a,b,c)=>{c.d(b,{Yv:()=>d.Yv,h3:()=>m,jK:()=>k,sD:()=>e.sD,tg:()=>l,ub:()=>e.ub,wc:()=>n});var d=c(7437),e=c(6535);let f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=["日","月","火","水","木","金","土"];function h(a,b,c){return Math.max(b,Math.min(c,a))}function i(a){return 0===a.length?0:a.reduce((a,b)=>a+b,0)/a.length}function j(a,b){let c=[...b.leadtimeFactor].sort((a,b)=>a.days_lt-b.days_lt);for(let b of c)if(a<b.days_lt)return b.factor;return c.length?c[c.length-1].factor:1}function k(a,b,c,l=e.ub){let m=b.getMonth()+1,n=l.monthFactor[a.area]?.[String(m)]??1,o=Array.from({length:c},(a,c)=>{let e=(0,d.fi)(b,c),h=f[(0,d.Mc)(e)];return{dateIso:(0,d.Nb)(e),dow:h,dowJp:g[(0,d.Mc)(e)],factor:l.dowFactor[h]}}),p=i(o.map(a=>a.factor)),q=l.longStayFactor[String(h(c,1,30))]??1,r=new Date,s=Math.max(0,Math.ceil((b.getTime()-r.getTime())/864e5)),t=j(s,l),u=Math.round(a.baselinePerNightJpy*n*p*q*t);return{baselinePerNightJpy:a.baselinePerNightJpy,month:{month:m,area:a.area,factor:n},dowFactors:o,dowAvg:p,longStay:{nights:c,factor:q},leadtime:{daysUntil:s,factor:t},fairPerNightJpy:u}}function l(a,b={}){let c=b.config??e.ub,g={...e.sD,...b.houses},k=b.targetDiscountRate??.25;return a.map(a=>{let b=function(a){if(!a)return;let b=a.replace(/\s+/g," ").trim().toUpperCase().replace(/ /g,"_");return b.includes("DESK")?"+DESK_FUKUOKA":b.includes("CHEF")?"+CHEF_FUKUOKA":b.includes("ATELIER")?"+ATELIER_FUKUOKA":b.includes("BASE")&&b.includes("S")&&(b.includes("KITA")||b.includes("KITAKARUIZAWA")||b.includes("KITA_KARUIZAWA"))?"BASE_S_KITA_KARUIZAWA":b.includes("AOSHIMA")||b.includes("MASTERPIECE")?"AOSHIMA_EXCLUSIVE":void 0}(a.house),l=b?g[b]:void 0,m=(0,d.Yv)(a.checkinJst),n=a.nights??1,o=l&&m?function(a,b,c,g=e.ub){let k=String(b.getMonth()+1),l=g.monthFactor[a.area]?.[k]??1,m=[];for(let a=0;a<c;a++){let c=(0,d.fi)(b,a),e=f[(0,d.Mc)(c)];m.push(g.dowFactor[e])}let n=i(m),o=g.longStayFactor[String(h(c,1,30))]??1,p=new Date,q=j(Math.max(0,Math.ceil((b.getTime()-p.getTime())/864e5)),g);return Math.round(a.baselinePerNightJpy*l*n*o*q)}(l,m,n,c):void 0,p=a.priceEth&&n?function(a,b,c=e.ub){return b&&b?Math.round(a*c.ethJpy/b):0}(a.priceEth,n,c):void 0,q=function(a,b){if(a&&b)return Math.round((1-a/b)*100)}(p,o),r=function(a){if(void 0!==a)return a>=30?"割安":a>=15?"やや割安":a>=-5?"妥当":a>=-30?"やや割高":"割高"}(q),s=function(a,b,c,d=e.ub){if(a&&b&&!(b<=0))return Math.round(1e6*(a*b*(1-c)/d.ethJpy))/1e6}(o,n,k,c);return{...a,houseId:b,area:l?.area,capacity:l?.capacity,baselinePerNightJpy:l?.baselinePerNightJpy,officialUrl:l?.officialUrl,officialThumbUrl:l?.officialThumbUrl,fairPerNightJpy:o,actualPerNightJpy:p,discountPct:q,label:r,maxBidEth25off:s}})}function m(a){let b=function(a){let b={};for(let c of a){let a=`${c.contract}:${c.tokenId}`;b[a]||(b[a]=[]),b[a].push(c)}return b}(a),c=[];for(let a of Object.values(b)){let b=a.slice().sort((a,b)=>(b.discountPct??-999)-(a.discountPct??-999))[0]||a[0];c.push({...b,listingsCount:a.length})}return c}function n(a){return a.slice().sort((a,b)=>(b.discountPct??-999)-(a.discountPct??-999))}},8747:(a,b,c)=>{c.d(b,{o:()=>y,c:()=>z});let d="the-key-nah",e="0xf3f8257fbcfdeff9354b6a0e1a948f7a5ff135a2";var f=c(1126),g=c(4038),h=c(1455),i=c(6760);function j(a){return a.replace(/[^a-z0-9_-]+/gi,"_").toLowerCase()}function k(a,b){if(!a)return;let c=j(a),d=function(a){if(!a)return".jpg";try{let b=new URL(a).pathname.toLowerCase();if(b.endsWith(".jpeg")||b.endsWith(".jpg"))return".jpg";if(b.endsWith(".png"))return".png";if(b.endsWith(".webp"))return".webp";if(b.endsWith(".gif"))return".gif";if(b.endsWith(".avif"))return".avif";return".jpg"}catch{return".jpg"}}(b);return`/house-images/${c}${d}`}async function l(a){if(!a)return;let b=j(a),c=(0,i.join)(process.cwd(),"public","house-images",`${b}.meta.json`);try{let a=await (0,h.readFile)(c,"utf8");return JSON.parse(a)}catch{return}}async function m(a,b=1200){let c=await l(a);if(!c)return{};let d=Object.keys(c.files).map(a=>Number.parseInt(a,10)).filter(a=>Number.isFinite(a)).sort((a,b)=>a-b);if(0===d.length)return{blurDataURL:c.blurDataURL};let e=d.find(a=>a>=b)??d[d.length-1];return{src:c.files[String(e)],blurDataURL:c.blurDataURL}}var n=c(7302);async function o(a,b,c=5,d=600){let e=0;for(;;){let f=await fetch(a,{headers:b});if(f.ok)return await f.json();if(e++,!(429===f.status||f.status>=500&&f.status<600)||e>c){let b=await f.text().catch(()=>"");throw Error(`HTTP ${f.status} ${f.statusText} for ${a}
${b}`)}let g=d*2**(e-1);await function(a){return new Promise(b=>setTimeout(b,a))}(g)}}async function p(a,b,c=5){let d=Array(a.length),e=0;async function f(){for(;;){let c=e++;if(c>=a.length)break;d[c]=await b(a[c],c)}}let g=Array.from({length:Math.min(c,a.length)},f);return await Promise.all(g),d}function q(a){return Number(BigInt(a))/1e18}function r(a){let b=0n;for(let c of a)b+=BigInt(c.startAmount);return b.toString()}function s(a){let b=Number(a);return Number.isFinite(b)?new Date(1e3*b).toISOString():""}function t(a,b){if(!a)return;let c=a.find(a=>a.trait_type.toLowerCase().includes(b.toLowerCase()));if(c)return String(c.value)}let u="https://api.opensea.io/api/v2";async function v(a,b,c="best"){let d,e={"X-API-KEY":b},f=[];do{let b=function(a,b,c=200,d){let e="best"===b?`listings/collection/${a}/best`:`listings/collection/${a}/all`,f=new URL(`${u}/${e}`);return f.searchParams.set("limit",String(c)),d&&f.searchParams.set("next",d),f.toString()}(a,c,200,d),g=await o(b,e);f.push(...g.listings??[]),d=g.next??void 0}while(d);return f}async function w(a,b,c){return o(`${u}/chain/ethereum/contract/${a}/nfts/${b}`,{"X-API-KEY":c})}async function x(a,b,c="all"){let d=await v(a,b,c),e=a=>{let b=a.protocol_data.parameters.offer[0];return`${b.token}:${b.identifierOrCriteria}`},f=new Map;for(let a of d)f.set(e(a),a);let g=[...f.values()],h=await p(g,async a=>{let c=a.protocol_data.parameters.offer[0];try{return await w(c.token,c.identifierOrCriteria,b)}catch(a){return null}},5),i=new Map;return g.forEach((a,b)=>{let c=a.protocol_data.parameters.offer[0];i.set(`${c.token}:${c.identifierOrCriteria}`,h[b])}),d.map(a=>{let b=a.protocol_data.parameters.offer[0];return function(a,b){var c;let d,e=a.protocol_data.parameters,f=e.offer[0],g=f.identifierOrCriteria,h=f.token,i=q(a.price.current.value),j=r(e.consideration.filter(a=>a.recipient.toLowerCase()===e.offerer.toLowerCase())),k=r(e.consideration.filter(a=>a.recipient.toLowerCase()!==e.offerer.toLowerCase())),l=q(j),m=q(k),n=b?.nft?.traits,o=t(n,"house"),p=t(n,"place"),u=function(a){if(!a)return;let b=a.match(/\d+/);return b?Number(b[0]):void 0}(t(n,"number of nights")),v=t(n,"check-in date");if(b?.nft?.name){let a=b.nft.name.match(/\b([A-Za-z]{3,})\.?\s*(\d{1,2}),\s*(\d{4})\b/);if(a){let[b,c,e,f]=a,g={JANUARY:"01",FEBRUARY:"02",MARCH:"03",APRIL:"04",MAY:"05",JUNE:"06",JULY:"07",AUGUST:"08",SEPTEMBER:"09",OCTOBER:"10",NOVEMBER:"11",DECEMBER:"12",JAN:"01",FEB:"02",MAR:"03",APR:"04",JUN:"06",JUL:"07",AUG:"08",SEP:"09",OCT:"10",NOV:"11",DEC:"12"},h=c.toUpperCase(),i=g[h]??g[h.slice(0,3)],j=e.padStart(2,"0");i&&(d=`${f}-${i}-${j}`)}}!d&&v&&(d=v);let w=o||void 0;return w&&p&&!w.toUpperCase().includes(p.toUpperCase())&&(w=`${w} ${p}`),{orderHash:a.order_hash,chain:a.chain,contract:h,tokenId:g,priceEth:i,sellerNetEth:l,feesEth:m,startTimeIso:s(e.startTime),endTimeIso:s(e.endTime),house:w||void 0,place:p||void 0,nights:u||void 0,checkinJst:d||void 0,openseaAssetUrl:(c=a.chain,`https://opensea.io/assets/${"ethereum"===c?"ethereum":c}/${h}/${g}`)}}(a,i.get(`${b.token}:${b.identifierOrCriteria}`)??null)})}async function y(a,b={}){let c=b.limit??24,e=b.slug??d,h=b.mode??"all",i=await x(e,a,h),j=i.length,l=await (0,f.z)(),o=(0,n.tg)(i,{config:{...n.ub,ethJpy:l}}),p=(0,n.h3)(o),q=(0,n.wc)(p).slice(0,c);return{totalListings:j,items:await Promise.all(q.map(async a=>{let b=a.houseId?n.sD[a.houseId]:void 0,c=b?.displayName??a.house??"UNKNOWN",d=a.officialThumbUrl,e=k(a.houseId,d),f=await m(a.houseId,800),h=f.src??e??d,i={actualJpyPerNight:(0,g.Zr)(a.actualPerNightJpy),fairJpyPerNight:(0,g.Zr)(a.fairPerNightJpy),discountPct:(0,g.R8)(a.discountPct),priceEth:(0,g.Z4)(a.priceEth),checkin:a.checkinJst?(0,g.OT)(a.checkinJst):void 0,imageUrl:h,blurDataURL:f.blurDataURL,label:a.label??"",nights:a.nights??1};return{item:a,title:c,display:i}}))}}async function z(a,b,c={}){let h=c.slug??d,i=(await x(h,a,"all")).filter(a=>a.contract.toLowerCase()===e&&a.tokenId===b),j=await (0,f.z)(),l=(0,n.tg)(i,{config:{...n.ub,ethJpy:j}}),o=l.length>0?(0,n.h3)(l)[0]:void 0,p=l.length>0?(0,n.wc)(l).slice(1):[],q=o?.houseId?n.sD[o.houseId]:void 0,r=o?.house??b,s=o?.houseId?k(o.houseId,o.officialThumbUrl):void 0,t=await m(o?.houseId,1200),u=t.src??s??o?.officialThumbUrl,v=o?.checkinJst?(0,n.Yv)(o.checkinJst):void 0,y=q&&v&&o?.nights?(0,n.jK)(q,v,o.nights):void 0,A={checkin:o?.checkinJst?(0,g.OT)(o.checkinJst):void 0,nights:o?.nights??1,priceEth:o?.priceEth!=null?(0,g.Z4)(o.priceEth):void 0,discountPct:o?.discountPct!=null?(0,g.R8)(o.discountPct):void 0,officialUrl:o?.officialUrl,openseaAssetUrl:o?.openseaAssetUrl},B={actualPerNight:o?.actualPerNightJpy!=null?(0,g.Zr)(o.actualPerNightJpy):void 0,fairPerNight:(o?.fairPerNightJpy??y?.fairPerNightJpy)!=null?(0,g.Zr)(o?.fairPerNightJpy??y?.fairPerNightJpy):void 0,equation:{priceEth:o?.priceEth!=null?(0,g.Z4)(o.priceEth):void 0,ethJpy:(0,g.Zr)(j),nights:o?.nights??1},breakdown:y?{baselineJpy:(0,g.Zr)(y.baselinePerNightJpy),month:y.month,dowLines:y.dowFactors.map(a=>`${a.dateIso}(${a.dowJp}) \xd7 ${a.factor}`),dowAvg:y.dowAvg.toFixed(2),longStay:y.longStay,leadtime:y.leadtime}:void 0},C=p.map(a=>({orderHash:a.orderHash,priceEth:null!=a.priceEth?(0,g.Z4)(a.priceEth):void 0,actualPerNight:null!=a.actualPerNightJpy?(0,g.Zr)(a.actualPerNightJpy):void 0,fairPerNight:null!=a.fairPerNightJpy?(0,g.Zr)(a.fairPerNightJpy):void 0,discountPct:null!=a.discountPct?(0,g.R8)(a.discountPct):void 0,start:a.startTimeIso?.slice(0,10)??"",end:a.endTimeIso?.slice(0,10)??"",url:a.openseaAssetUrl})),D=await w(e,b,a),E=D.nft?.traits??[];return{title:r,imageUrl:u,blurDataURL:t.blurDataURL,header:A,pricing:B,otherListings:C,traits:E}}},9498:(a,b,c)=>{c.d(b,{default:()=>d});let d=(0,c(580).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/nasjp/ghq/github.com/nasjp/nah-key-scout/apps/web/src/components/FadeImage.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/nasjp/ghq/github.com/nasjp/nah-key-scout/apps/web/src/components/FadeImage.tsx","default")}};